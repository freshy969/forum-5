<html>
  <head>
    <script src="https://npmcdn.com/ipfs-api/dist/index.js"></script>
    <script src="js/scripts.js"></script>
    <link rel='stylesheet' href='style.css' type='text/css'>
  </head>

  <fieldset style="border-style: none; border-top-style: solid; padding-bottom: 0px; background-color: inherit;">
    <legend><a href= "index.html">Home</a> <a id="home-user" class = >My Posts</a></legend>
  </fieldset>
  <br>


  <fieldset id="posts">
    <legend><h2 id = "user"></h2></legend>
  </fieldset>


<script type="text/javascript">
  function init() {
    query = decodeURI(getParameterByName('query'));
    document.getElementById("user").innerHTML = "Posts by: " + query;
    var noWeb3 = document.getElementById('noWeb3')
    // IPFS Initialization
    ipfs = window.IpfsApi('localhost', '5001');

    // Web3 Initialization
    if(typeof web3 !== 'undefined' && typeof Web3 !== 'undefined') {
        // If there's a web3 library loaded, then make your own web3
        web3 = new Web3(web3.currentProvider);
    } else if (typeof Web3 !== 'undefined') {
        // If there isn't then set a provider
        web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
    } else if(typeof web3 == 'undefined') {
      // Alert the user he is not in a web3 compatible browser
      console.log("not web3 compatible");
      document.getElementById("noWeb3").style.display = "block";

      return;
    }

    document.getElementById('home-user').href = "user.html?query=" + web3.eth.accounts[0];

    forum.getPostsFromAuthor(query, function(error, result) {
      for(i = 0; i < result.length; i++) {
        var post = document.createElement("fieldset");
        post.id = "post" + i.toString();
        postContent = document.createElement("a");
        postContent.href = "page.html?query="+result[i]
        forum.getTitle(result[i], function(error, result) {
          postContent.textContent = result;
        });
        document.getElementById("posts").appendChild(post)
        post.appendChild(postContent);

        if (web3.eth.accounts[0] === query) {
          tagForm = document.createElement('input');
          tagForm.id = i;
          tagForm.style = "display:inline; float: right;"
          tagForm.type = "text";
          tagForm.placeholder = "Enter Tag"
          post.appendChild(tagForm)
          document.getElementById(tagForm.id).onkeyup = function (e) {
            if (e.keyCode == 13 ){
              console.log(result[tagForm.id]);
              tagPost(result[tagForm.id], document.getElementById(tagForm.id).value);
            }
          }
        }
      }

    });

  }

  if (document.addEventListener) document.addEventListener("DOMContentLoaded", init, false);
  else if (document.attachEvent) document.attachEvent("onreadystatechange", init);
  else window.onload = init;
</script>
</html>
